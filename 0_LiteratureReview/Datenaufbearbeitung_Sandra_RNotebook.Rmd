---
title: "R Notebook - Datenaufbearbeitung"
output: html_notebook
author: Sandra Schulze

# df_print: paged
---

### Einbinden benötigter Bibliotheken:

- lubridate:    Zur Arbeit mit Datums- und Zeitangaben
- readr:        Zum Einlesen von Daten aus verschiedenen Dateiformaten wie CSV, TSV oder TXT
- dplyr:        Für die Datenmanipulation und -transformation: Filtern, Sortieren und Zusammenfassen von Daten 
- ggplot2:      Zur Erstellung von ansprechenden und flexiblen Grafiken
- skimr:        Für die deskriptive Statistik und das schnelle Überprüfen von Daten
- stringr:      Für die Arbeit mit Zeichenketten 
- dataexplorer: Für 
- VIM:          Für die Berechnung der fehlenden Daten: Hot Deck Imputation
- HTTR:         Für die Berechnung des MAPE
- Broom:        Bei Overfitting Lineare Regression
- Metrics:      Bei Overfitting Lineare Regression

```{r}
library(readr)
library(dplyr)
library(skimr)

# Es wird überprüft ob "devtools" installiert ist; devtools ist ein Package, um Package von GitHub zu installieren
if (!require(devtools)) install.packages("devtools")
# Es wird überprüft, ob das Package DataExplorer bereits installiert ist, ansonsten wird es von GitHub installiert
if (!require(DataExplorer)) devtools::install_github("boxuancui/DataExplorer")

library(DataExplorer)

```

### Einlesen der Daten:

- vorgebener Datensatz

```{r}
umsatzdaten <- read_csv("C:/Users/Efflo/OneDrive/Έγγραφα/GitHub/Gruppe1/0_LiteratureReview/umsatzdaten_gekuerzt.csv")

kiwo <- read_csv("C:/Users/Efflo/OneDrive/Έγγραφα/GitHub/Gruppe1/0_LiteratureReview/kiwo.csv")

wetter <- read_csv("C:/Users/Efflo/OneDrive/Έγγραφα/GitHub/Gruppe1/0_LiteratureReview/wetter.csv")

```

- selbst erstellte Variablen:


```{r}
wetterplus <- read_csv("C:/Users/Efflo/OneDrive/Έγγραφα/GitHub/Gruppe1/0_LiteratureReview/wetter_plus.csv")

```




### Zusammenführen der Daten:

```{r}
daten <- left_join(umsatzdaten, kiwo, wetterplus, by="Datum")

```


```{r}
library(ggplot2) # Einbinden von ggplot2, um den darin enthaltenen Datensatz mpg zu nutzen
library(dplyr)
library(lubridate)
library(stringr)


#### Gruppenweise Ausführung eines T-Tests ####

mpg %>%
  group_by(cyl) %>%
  summarise(n(), t.test(cty,hwy)$p.value)
```


```{r}
#### Beispiel für die Aufbereitung mit dplyr ####
mpg %>%
  select (class, hwy, cty) %>%    # Beschränkung des mpg Datensatzes auf die Variablen class, hwy und cty
  filter (class=="suv") %>%       # Beschränkung des Datensatzes auf alle Fälle (Cases), bei denen die Variable class dem Wert 'suv' entspricht
  mutate (mix = .5*hwy + .5*cty)  # Berechnen und Hinzufügen einer neuen Variable mit dem Namen mix und den entsprechend berechneten Werten
```


```{r}
#### Beispiel für die Aufbereitung mit lubridate #### 
mdy("4/1/17")  # Umwandlung eines Strings in ein Datum
```


```{r}
#### Beispiel 1 für die Aufbereitung/Transformation mit stringr #### 
str_replace("AAA", "A", "B")
```

```{r}
#### Beispiel 2 für die Aufbereitung/Transformation mit stringr #### 
str_replace_all("AAA", "A", "B")
```


```{r}
#### Beispiel 3 für die Aufbereitung/Transformation mit stringr #### 
str_replace("AAA", "A$", "B")
```


```{r}
#### Beispiel 4 für die Aufbereitung/Transformation mit stringr #### 
str_trim("   Vorname   ")
```


```{r}
#### Beispiel 5 für die Aufbereitung/Transformation mit stringr #### 
str_replace_all("   Vorna me   ","^[ \\s]+|[ \\s]+$", "")

```

```{r}
#### Beispiel für die Nutzung von skim
umsatzdaten$Warengruppe = as.factor(umsatzdaten$Warengruppe)
skim(umsatzdaten)

```


```{r}
### Umgang mit fehlenden Daten

library(readr)
library(VIM)
library(dplyr)

sleep <- VIM::sleep

# VIM Aggregation Plot
sleep %>% aggr(combined=TRUE, numbers=TRUE)

# Listwise deletion
sleep_deletion <- na.omit(sleep)
sleep_deletion %>% aggr(combined=TRUE, numbers=TRUE)

# VIM Hot-Deck Imputation
sleep_hotdeck1 <- sleep %>%  hotdeck()
sleep_hotdeck1 %>% aggr(combined=TRUE, numbers=TRUE)
ggplot(sleep_hotdeck1) +
  geom_point(aes(x=Sleep, y=Dream, color=Sleep_imp))

sleep_hotdeck2 <- sleep %>%  hotdeck(ord_var = "Dream")
sleep_hotdeck2 %>% aggr(combined=TRUE, numbers=TRUE)

sleep_hotdeck3 <- sleep_hotdeck2 %>%  hotdeck(ord_var = "Sleep")
sleep_hotdeck3 %>% aggr(combined=TRUE, numbers=TRUE)

# VIM Iterative Robust Model Imputation (IRMI)
sleep_irmi <- sleep %>%  irmi()
ggplot(sleep_irmi) +
  geom_point(aes(x=Sleep, y=Dream, color=Sleep_imp))


# Impact
cor(sleep_deletion$Sleep, sleep_deletion$Dream)
cor(sleep_hotdeck1$Sleep, sleep_hotdeck1$Dream, use = "complete.obs")
cor(sleep_hotdeck2$Sleep, sleep_hotdeck2$Dream, use = "complete.obs")
cor(sleep_hotdeck3$Sleep, sleep_hotdeck3$Dream, use = "complete.obs")
cor(sleep_irmi$Sleep, sleep_irmi$Dream)

```      
      
```{r}
library(DataExplorer)

plot_missing(umsatzdaten)
plot_histogram(umsatzdaten)

```

### Balkendiagram: Barplot with error bars URL: https://r-graph-gallery.com/4-barplot-with-error-bar.html

```{r}

# Load ggplot2
library(ggplot2)

# create dummy data
data <- data.frame(
  name=letters[1:5],
  value=sample(seq(4,15),5),
  sd=c(1,0.2,3,2,4)
)
 
# Most basic error bar
ggplot(data) +
    geom_bar( aes(x=name, y=value), stat="identity", fill="skyblue", alpha=0.7) +
    geom_errorbar( aes(x=name, ymin=value-sd, ymax=value+sd), width=0.4, colour="orange", alpha=0.9, size=1.3)
    
```    

Balkendiagramm, das den Zusammenhang von xx  und yy darstellt:
```{r}

ggplot(mpg)+
  geom_bar(aes(x = as.factor(class), y = cty), stat = "identity")

```


### Konvidenzintervall


```{r}
# Load ggplot2
library(ggplot2)
library(dplyr)

# Data
data <- iris %>% select(Species, Sepal.Length) 
 
# Calculates mean, sd, se and IC
my_sum <- data %>%
  group_by(Species) %>%
  summarise( 
    n=n(),
    mean=mean(Sepal.Length),
    sd=sd(Sepal.Length)
  ) %>%
  mutate( se=sd/sqrt(n))  %>%
  mutate( ic=se * qt((1-0.05)/2 + .5, n-1))
 
# Standard deviation
ggplot(my_sum) +
  geom_bar( aes(x=Species, y=mean), stat="identity", fill="forestgreen", alpha=0.5) +
  geom_errorbar( aes(x=Species, ymin=mean-sd, ymax=mean+sd), width=0.4, colour="orange", alpha=0.9, size=1.5) +
  ggtitle("using standard deviation")
 
# Standard Error
ggplot(my_sum) +
  geom_bar( aes(x=Species, y=mean), stat="identity", fill="forestgreen", alpha=0.5) +
  geom_errorbar( aes(x=Species, ymin=mean-se, ymax=mean+se), width=0.4, colour="orange", alpha=0.9, size=1.5) +
  ggtitle("using standard error")
 
# Confidence Interval
ggplot(my_sum) +
  geom_bar( aes(x=Species, y=mean), stat="identity", fill="forestgreen", alpha=0.5) +
  geom_errorbar( aes(x=Species, ymin=mean-ic, ymax=mean+ic), width=0.4, colour="orange", alpha=0.9, size=1.5) +
  ggtitle("using confidence interval")
  
```
